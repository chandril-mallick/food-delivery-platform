{"ast":null,"code":"// firebase/firestore.js\nimport { collection, getDocs, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, query, where, orderBy, limit, serverTimestamp, onSnapshot } from \"firebase/firestore\";\nimport { getAuth, signInAnonymously } from 'firebase/auth';\n\n// Import the existing Firebase app and services from the main firebase.js file\nimport app, { db } from '../firebase.js';\n\n// Env flag for development logging\nconst isDev = process.env.NODE_ENV !== 'production' || process.env.REACT_APP_ENABLE_DEV === 'true';\n\n// Ensure there is an authenticated Firebase user (anonymous if needed)\nlet _ensuringAuth = false;\nconst ensureFirebaseAuth = async () => {\n  try {\n    const auth = getAuth(app);\n    if (auth.currentUser || _ensuringAuth) return;\n    _ensuringAuth = true;\n    await signInAnonymously(auth).catch(e => {\n      if (isDev) {\n        // eslint-disable-next-line no-console\n        console.warn('[Firestore] Anonymous auth failed (rules may require auth):', e === null || e === void 0 ? void 0 : e.message);\n      }\n    });\n  } finally {\n    _ensuringAuth = false;\n  }\n};\n\n// ✅ Function to fetch collection\nexport const getCollection = async collectionName => {\n  const colRef = collection(db, collectionName);\n  const snapshot = await getDocs(colRef);\n  return snapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n};\n\n// ✅ Function to get a single document\nexport const getDocument = async (collectionName, docId) => {\n  const docRef = doc(db, collectionName, docId);\n  const docSnap = await getDoc(docRef);\n  if (docSnap.exists()) {\n    return {\n      id: docSnap.id,\n      ...docSnap.data()\n    };\n  } else {\n    throw new Error('Document not found');\n  }\n};\n\n// ✅ Function to add a document\nexport const addDocument = async (collectionName, data) => {\n  const docRef = await addDoc(collection(db, collectionName), {\n    ...data,\n    createdAt: serverTimestamp(),\n    updatedAt: serverTimestamp()\n  });\n  return docRef.id;\n};\n\n// ✅ Function to update a document\nexport const updateDocument = async (collectionName, docId, data) => {\n  const docRef = doc(db, collectionName, docId);\n  await updateDoc(docRef, {\n    ...data,\n    updatedAt: serverTimestamp()\n  });\n};\n\n// ✅ Function to delete a document\nexport const deleteDocument = async (collectionName, docId) => {\n  const docRef = doc(db, collectionName, docId);\n  await deleteDoc(docRef);\n};\n\n// ===== ORDER MANAGEMENT FUNCTIONS =====\n\n// ✅ Create a new order\nexport const createOrder = async orderData => {\n  var _auth$currentUser;\n  // Make sure Firestore write has auth context (compatible with Supabase auth flow)\n  await ensureFirebaseAuth();\n\n  // Capture current Firebase auth UID to store on the order for rule checks\n  const auth = getAuth(app);\n  const authUid = ((_auth$currentUser = auth.currentUser) === null || _auth$currentUser === void 0 ? void 0 : _auth$currentUser.uid) || null;\n  const order = {\n    ...orderData,\n    authUid,\n    // used by security rules for reads/writes by the same Firebase user\n    status: 'pending',\n    createdAt: serverTimestamp(),\n    updatedAt: serverTimestamp(),\n    orderNumber: `ORD-${Date.now()}`,\n    estimatedDeliveryTime: new Date(Date.now() + 30 * 60 * 1000) // 30 minutes from now\n  };\n  try {\n    const docRef = await addDoc(collection(db, 'orders'), order);\n    return docRef.id;\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error('[Firestore] createOrder failed:', (e === null || e === void 0 ? void 0 : e.code) || (e === null || e === void 0 ? void 0 : e.name), e === null || e === void 0 ? void 0 : e.message);\n    throw e;\n  }\n};\n\n// ✅ Get orders by user ID\nexport const getUserOrders = async userId => {\n  const q = query(collection(db, 'orders'), where('userId', '==', userId));\n  const snapshot = await getDocs(q);\n  const orders = snapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n  // Sort by createdAt in JavaScript to avoid needing a composite index\n  return orders.sort((a, b) => {\n    var _a$createdAt, _a$createdAt$toDate, _b$createdAt, _b$createdAt$toDate;\n    const aTime = ((_a$createdAt = a.createdAt) === null || _a$createdAt === void 0 ? void 0 : (_a$createdAt$toDate = _a$createdAt.toDate) === null || _a$createdAt$toDate === void 0 ? void 0 : _a$createdAt$toDate.call(_a$createdAt)) || a.createdAt || new Date(0);\n    const bTime = ((_b$createdAt = b.createdAt) === null || _b$createdAt === void 0 ? void 0 : (_b$createdAt$toDate = _b$createdAt.toDate) === null || _b$createdAt$toDate === void 0 ? void 0 : _b$createdAt$toDate.call(_b$createdAt)) || b.createdAt || new Date(0);\n    return bTime - aTime; // Descending order (newest first)\n  });\n};\n\n// ✅ Get order by ID\nexport const getOrderById = async orderId => {\n  return await getDocument('orders', orderId);\n};\n\n// ✅ Update order status\nexport const updateOrderStatus = async (orderId, status) => {\n  await updateDocument('orders', orderId, {\n    status\n  });\n};\n\n// ✅ Get all orders (for admin)\nexport const getAllOrders = async (limitCount = 50) => {\n  const q = query(collection(db, 'orders'), orderBy('createdAt', 'desc'), limit(limitCount));\n  const snapshot = await getDocs(q);\n  return snapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n};\n\n// ✅ Get orders by status\nexport const getOrdersByStatus = async status => {\n  const q = query(collection(db, 'orders'), where('status', '==', status));\n  const snapshot = await getDocs(q);\n  const orders = snapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data()\n  }));\n  // Sort by createdAt in JavaScript to avoid needing a composite index\n  return orders.sort((a, b) => {\n    var _a$createdAt2, _a$createdAt2$toDate, _b$createdAt2, _b$createdAt2$toDate;\n    const aTime = ((_a$createdAt2 = a.createdAt) === null || _a$createdAt2 === void 0 ? void 0 : (_a$createdAt2$toDate = _a$createdAt2.toDate) === null || _a$createdAt2$toDate === void 0 ? void 0 : _a$createdAt2$toDate.call(_a$createdAt2)) || a.createdAt || new Date(0);\n    const bTime = ((_b$createdAt2 = b.createdAt) === null || _b$createdAt2 === void 0 ? void 0 : (_b$createdAt2$toDate = _b$createdAt2.toDate) === null || _b$createdAt2$toDate === void 0 ? void 0 : _b$createdAt2$toDate.call(_b$createdAt2)) || b.createdAt || new Date(0);\n    return bTime - aTime; // Descending order (newest first)\n  });\n};\n\n// ✅ Real-time order tracking\nexport const subscribeToOrder = (orderId, callback) => {\n  const docRef = doc(db, 'orders', orderId);\n  return onSnapshot(docRef, doc => {\n    if (doc.exists()) {\n      callback({\n        id: doc.id,\n        ...doc.data()\n      });\n    }\n  });\n};\n\n// ✅ Real-time user orders tracking\nexport const subscribeToUserOrders = (userId, callback) => {\n  if (isDev) {\n    // eslint-disable-next-line no-console\n    console.log('Firebase subscribeToUserOrders: Setting up query for userId:', userId);\n  }\n  // Proxy unsubscribe to keep the same return type while we ensure auth first\n  let innerUnsub = () => {};\n  (async () => {\n    try {\n      var _auth$currentUser2;\n      // Ensure there is an auth context before opening a watch stream (rules require signed-in user)\n      await ensureFirebaseAuth();\n      const auth = getAuth(app);\n      const currentUid = ((_auth$currentUser2 = auth.currentUser) === null || _auth$currentUser2 === void 0 ? void 0 : _auth$currentUser2.uid) || null;\n\n      // Prefer secure filter by authUid (the Firebase UID stored on the order).\n      // Fallback to userId equality if authUid is not available (legacy data).\n      const base = collection(db, 'orders');\n      const q = currentUid ? query(base, where('authUid', '==', currentUid)) : query(base, where('userId', '==', userId));\n      innerUnsub = onSnapshot(q, snapshot => {\n        if (isDev) {\n          // eslint-disable-next-line no-console\n          console.log('Firebase subscribeToUserOrders: Snapshot received, docs count:', snapshot.docs.length);\n        }\n        const orders = snapshot.docs.map(doc => {\n          const data = {\n            id: doc.id,\n            ...doc.data()\n          };\n          if (isDev) {\n            // eslint-disable-next-line no-console\n            console.log('Firebase subscribeToUserOrders: Order doc:', doc.id, data);\n          }\n          return data;\n        });\n        // Sort by createdAt in JavaScript to avoid needing a composite index\n        const sortedOrders = orders.sort((a, b) => {\n          var _a$createdAt3, _a$createdAt3$toDate, _b$createdAt3, _b$createdAt3$toDate;\n          const aTime = ((_a$createdAt3 = a.createdAt) === null || _a$createdAt3 === void 0 ? void 0 : (_a$createdAt3$toDate = _a$createdAt3.toDate) === null || _a$createdAt3$toDate === void 0 ? void 0 : _a$createdAt3$toDate.call(_a$createdAt3)) || a.createdAt || new Date(0);\n          const bTime = ((_b$createdAt3 = b.createdAt) === null || _b$createdAt3 === void 0 ? void 0 : (_b$createdAt3$toDate = _b$createdAt3.toDate) === null || _b$createdAt3$toDate === void 0 ? void 0 : _b$createdAt3$toDate.call(_b$createdAt3)) || b.createdAt || new Date(0);\n          return bTime - aTime; // Descending order (newest first)\n        });\n        if (isDev) {\n          // eslint-disable-next-line no-console\n          console.log('Firebase subscribeToUserOrders: Returning sorted orders:', sortedOrders.length, 'orders');\n        }\n        callback(sortedOrders);\n      }, error => {\n        console.error('Firebase subscribeToUserOrders: Error in snapshot listener:', error);\n      });\n    } catch (e) {\n      console.error('Firebase subscribeToUserOrders: Failed to ensure auth or attach listener:', e);\n    }\n  })();\n  return () => {\n    try {\n      innerUnsub();\n    } catch (e) {}\n  };\n};\n\n// ===== MENU FUNCTIONS =====\n\n// ✅ Get menu items\nexport const getMenuItems = async () => {\n  try {\n    const items = await getCollection('menuItems');\n    if (Array.isArray(items) && items.length > 0) return items;\n  } catch (e) {\n    // fall through to fallback\n  }\n  try {\n    // Fallback to legacy collection name (lowercase)\n    const items = await getCollection('menu');\n    if (Array.isArray(items) && items.length > 0) return items;\n  } catch (e) {\n    // fall through\n  }\n  // Final fallback to capitalized collection name\n  return await getCollection('Menu');\n};\n\n// ✅ Get menu item by ID\nexport const getMenuItem = async itemId => {\n  return await getDocument('menuItems', itemId);\n};\n\n// ✅ Get popular menu items\nexport const getPopularMenuItems = async () => {\n  try {\n    // Try different possible collection names\n    const possibleCollections = ['popularMenu', 'popular-menu', 'popular menu', 'popular_items', 'popularItems'];\n    for (const collectionName of possibleCollections) {\n      try {\n        const items = await getCollection(collectionName);\n        if (items && items.length > 0) {\n          if (isDev) {\n            // eslint-disable-next-line no-console\n            console.log(`Found popular items in collection: ${collectionName}`, items);\n          }\n          // Ensure each item has a valid image URL\n          return items.map(item => ({\n            ...item,\n            image: item.image || '/placeholder-dish.png' // Fallback image\n          }));\n        }\n      } catch (e) {\n        if (isDev) {\n          // eslint-disable-next-line no-console\n          console.log(`Collection ${collectionName} not found, trying next...`);\n        }\n      }\n    }\n\n    // If no collection found, return fallback data\n    if (isDev) {\n      // eslint-disable-next-line no-console\n      console.warn('No popular menu items found in any collection. Using fallback data.');\n    }\n    return [{\n      id: 'fallback-1',\n      name: 'Chicken Biriyani',\n      description: 'Aromatic chicken biriyani',\n      price: 99,\n      rating: 4.8,\n      deliveryTime: '30-40 min',\n      isVeg: false,\n      image: '/chicken-biriyani.jpeg'\n    }, {\n      id: 'fallback-2',\n      name: 'Mutton Biriyani',\n      description: 'Aromatic mutton biriyani',\n      price: 179,\n      rating: 4.7,\n      deliveryTime: '25-35 min',\n      isVeg: true,\n      image: '/mutton-biriyani.jpeg'\n    }];\n  } catch (error) {\n    console.error('Error in getPopularMenuItems:', error);\n    return [];\n  }\n};\n\n// ===== OFFERS (PROMOTIONS) =====\n\n// Get all offers\nexport const getOffers = async () => {\n  return await getCollection('offers');\n};\n\n// Real-time offers subscription\nexport const subscribeToOffers = callback => {\n  const colRef = collection(db, 'offers');\n  return onSnapshot(colRef, snapshot => {\n    const items = snapshot.docs.map(d => ({\n      id: d.id,\n      ...d.data()\n    }));\n    callback(items);\n  });\n};\n\n// ===== USER FUNCTIONS =====\n\n// ✅ Create or update user profile\nexport const saveUserProfile = async (userId, userData) => {\n  const userRef = doc(db, 'users', userId);\n  const userSnap = await getDoc(userRef);\n  if (userSnap.exists()) {\n    // Update existing user\n    await updateDoc(userRef, {\n      ...userData,\n      updatedAt: serverTimestamp()\n    });\n  } else {\n    // Create new user with userId as document ID\n    await setDoc(userRef, {\n      ...userData,\n      userId,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp()\n    });\n  }\n};\n\n// ✅ Get user profile\nexport const getUserProfile = async userId => {\n  // Ensure there is an auth context for rules that require signed-in users\n  await ensureFirebaseAuth();\n  const userRef = doc(db, 'users', userId);\n  const userSnap = await getDoc(userRef);\n  if (userSnap.exists()) {\n    return {\n      id: userSnap.id,\n      ...userSnap.data()\n    };\n  }\n  return null;\n};\nexport { db };\n\n// ===== APP STATUS (OPEN/CLOSE) =====\n\n// Real-time subscription to app open/close status\nexport const subscribeToAppStatus = callback => {\n  const statusRef = doc(db, 'settings', 'appStatus');\n  return onSnapshot(statusRef, snap => {\n    if (snap.exists()) {\n      const data = snap.data();\n      callback({\n        isOpen: data.isOpen !== false,\n        message: data.message || ''\n      });\n    } else {\n      // Default to open if doc missing\n      callback({\n        isOpen: true,\n        message: ''\n      });\n    }\n  }, error => {\n    console.error('[Firestore] subscribeToAppStatus error:', error);\n    // On error, default to open to avoid blocking users\n    callback({\n      isOpen: true,\n      message: ''\n    });\n  });\n};\n\n// Update app open/close status\nexport const setAppStatus = async ({\n  isOpen,\n  message\n}, user) => {\n  await ensureFirebaseAuth();\n  const statusRef = doc(db, 'settings', 'appStatus');\n  await setDoc(statusRef, {\n    isOpen: Boolean(isOpen),\n    message: message || '',\n    updatedAt: serverTimestamp(),\n    updatedBy: (user === null || user === void 0 ? void 0 : user.email) || (user === null || user === void 0 ? void 0 : user.uid) || 'system'\n  }, {\n    merge: true\n  });\n};\n\n// ===== SUPPORT (TICKETS) =====\n\n// Create a support ticket\nexport const createSupportTicket = async ticket => {\n  await ensureFirebaseAuth();\n  const payload = {\n    status: 'open',\n    source: 'web',\n    ...ticket,\n    createdAt: serverTimestamp(),\n    updatedAt: serverTimestamp()\n  };\n  const ref = await addDoc(collection(db, 'supportTickets'), payload);\n  return ref.id;\n};\n\n// Get support tickets for a user\nexport const getUserSupportTickets = async userId => {\n  const q = query(collection(db, 'supportTickets'), where('userId', '==', userId));\n  const snapshot = await getDocs(q);\n  const items = snapshot.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n  return items.sort((a, b) => {\n    var _a$createdAt4, _a$createdAt4$toDate, _b$createdAt4, _b$createdAt4$toDate;\n    const at = ((_a$createdAt4 = a.createdAt) === null || _a$createdAt4 === void 0 ? void 0 : (_a$createdAt4$toDate = _a$createdAt4.toDate) === null || _a$createdAt4$toDate === void 0 ? void 0 : _a$createdAt4$toDate.call(_a$createdAt4)) || a.createdAt || new Date(0);\n    const bt = ((_b$createdAt4 = b.createdAt) === null || _b$createdAt4 === void 0 ? void 0 : (_b$createdAt4$toDate = _b$createdAt4.toDate) === null || _b$createdAt4$toDate === void 0 ? void 0 : _b$createdAt4$toDate.call(_b$createdAt4)) || b.createdAt || new Date(0);\n    return bt - at;\n  });\n};\n\n// Subscribe to user's support tickets\nexport const subscribeToUserSupportTickets = (userId, callback) => {\n  const q = query(collection(db, 'supportTickets'), where('userId', '==', userId));\n  return onSnapshot(q, snapshot => {\n    const items = snapshot.docs.map(d => ({\n      id: d.id,\n      ...d.data()\n    }));\n    const sorted = items.sort((a, b) => {\n      var _a$createdAt5, _a$createdAt5$toDate, _b$createdAt5, _b$createdAt5$toDate;\n      const at = ((_a$createdAt5 = a.createdAt) === null || _a$createdAt5 === void 0 ? void 0 : (_a$createdAt5$toDate = _a$createdAt5.toDate) === null || _a$createdAt5$toDate === void 0 ? void 0 : _a$createdAt5$toDate.call(_a$createdAt5)) || a.createdAt || new Date(0);\n      const bt = ((_b$createdAt5 = b.createdAt) === null || _b$createdAt5 === void 0 ? void 0 : (_b$createdAt5$toDate = _b$createdAt5.toDate) === null || _b$createdAt5$toDate === void 0 ? void 0 : _b$createdAt5$toDate.call(_b$createdAt5)) || b.createdAt || new Date(0);\n      return bt - at;\n    });\n    callback(sorted);\n  });\n};","map":{"version":3,"names":["collection","getDocs","doc","getDoc","addDoc","setDoc","updateDoc","deleteDoc","query","where","orderBy","limit","serverTimestamp","onSnapshot","getAuth","signInAnonymously","app","db","isDev","process","env","NODE_ENV","REACT_APP_ENABLE_DEV","_ensuringAuth","ensureFirebaseAuth","auth","currentUser","catch","e","console","warn","message","getCollection","collectionName","colRef","snapshot","docs","map","id","data","getDocument","docId","docRef","docSnap","exists","Error","addDocument","createdAt","updatedAt","updateDocument","deleteDocument","createOrder","orderData","_auth$currentUser","authUid","uid","order","status","orderNumber","Date","now","estimatedDeliveryTime","error","code","name","getUserOrders","userId","q","orders","sort","a","b","_a$createdAt","_a$createdAt$toDate","_b$createdAt","_b$createdAt$toDate","aTime","toDate","call","bTime","getOrderById","orderId","updateOrderStatus","getAllOrders","limitCount","getOrdersByStatus","_a$createdAt2","_a$createdAt2$toDate","_b$createdAt2","_b$createdAt2$toDate","subscribeToOrder","callback","subscribeToUserOrders","log","innerUnsub","_auth$currentUser2","currentUid","base","length","sortedOrders","_a$createdAt3","_a$createdAt3$toDate","_b$createdAt3","_b$createdAt3$toDate","getMenuItems","items","Array","isArray","getMenuItem","itemId","getPopularMenuItems","possibleCollections","item","image","description","price","rating","deliveryTime","isVeg","getOffers","subscribeToOffers","d","saveUserProfile","userData","userRef","userSnap","getUserProfile","subscribeToAppStatus","statusRef","snap","isOpen","setAppStatus","user","Boolean","updatedBy","email","merge","createSupportTicket","ticket","payload","source","ref","getUserSupportTickets","_a$createdAt4","_a$createdAt4$toDate","_b$createdAt4","_b$createdAt4$toDate","at","bt","subscribeToUserSupportTickets","sorted","_a$createdAt5","_a$createdAt5$toDate","_b$createdAt5","_b$createdAt5$toDate"],"sources":["/Users/chandrilmallick/Downloads/web-projects/dabba-app/frontend/src/firebase/firestore.js"],"sourcesContent":["// firebase/firestore.js\nimport { \n  collection, \n  getDocs, \n  doc, \n  getDoc, \n  addDoc, \n  setDoc,\n  updateDoc, \n  deleteDoc, \n  query, \n  where, \n  orderBy, \n  limit,\n  serverTimestamp,\n  onSnapshot\n} from \"firebase/firestore\";\nimport { getAuth, signInAnonymously } from 'firebase/auth';\n\n// Import the existing Firebase app and services from the main firebase.js file\nimport app, { db } from '../firebase.js';\n\n// Env flag for development logging\nconst isDev = process.env.NODE_ENV !== 'production' || process.env.REACT_APP_ENABLE_DEV === 'true';\n\n// Ensure there is an authenticated Firebase user (anonymous if needed)\nlet _ensuringAuth = false;\nconst ensureFirebaseAuth = async () => {\n  try {\n    const auth = getAuth(app);\n    if (auth.currentUser || _ensuringAuth) return;\n    _ensuringAuth = true;\n    await signInAnonymously(auth).catch((e) => {\n      if (isDev) {\n        // eslint-disable-next-line no-console\n        console.warn('[Firestore] Anonymous auth failed (rules may require auth):', e?.message);\n      }\n    });\n  } finally {\n    _ensuringAuth = false;\n  }\n};\n\n// ✅ Function to fetch collection\nexport const getCollection = async (collectionName) => {\n  const colRef = collection(db, collectionName);\n  const snapshot = await getDocs(colRef);\n  return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n};\n\n// ✅ Function to get a single document\nexport const getDocument = async (collectionName, docId) => {\n  const docRef = doc(db, collectionName, docId);\n  const docSnap = await getDoc(docRef);\n  if (docSnap.exists()) {\n    return { id: docSnap.id, ...docSnap.data() };\n  } else {\n    throw new Error('Document not found');\n  }\n};\n\n// ✅ Function to add a document\nexport const addDocument = async (collectionName, data) => {\n  const docRef = await addDoc(collection(db, collectionName), {\n    ...data,\n    createdAt: serverTimestamp(),\n    updatedAt: serverTimestamp()\n  });\n  return docRef.id;\n};\n\n// ✅ Function to update a document\nexport const updateDocument = async (collectionName, docId, data) => {\n  const docRef = doc(db, collectionName, docId);\n  await updateDoc(docRef, {\n    ...data,\n    updatedAt: serverTimestamp()\n  });\n};\n\n// ✅ Function to delete a document\nexport const deleteDocument = async (collectionName, docId) => {\n  const docRef = doc(db, collectionName, docId);\n  await deleteDoc(docRef);\n};\n\n// ===== ORDER MANAGEMENT FUNCTIONS =====\n\n// ✅ Create a new order\nexport const createOrder = async (orderData) => {\n  // Make sure Firestore write has auth context (compatible with Supabase auth flow)\n  await ensureFirebaseAuth();\n\n  // Capture current Firebase auth UID to store on the order for rule checks\n  const auth = getAuth(app);\n  const authUid = auth.currentUser?.uid || null;\n\n  const order = {\n    ...orderData,\n    authUid, // used by security rules for reads/writes by the same Firebase user\n    status: 'pending',\n    createdAt: serverTimestamp(),\n    updatedAt: serverTimestamp(),\n    orderNumber: `ORD-${Date.now()}`,\n    estimatedDeliveryTime: new Date(Date.now() + 30 * 60 * 1000) // 30 minutes from now\n  };\n\n  try {\n    const docRef = await addDoc(collection(db, 'orders'), order);\n    return docRef.id;\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error('[Firestore] createOrder failed:', e?.code || e?.name, e?.message);\n    throw e;\n  }\n};\n\n// ✅ Get orders by user ID\nexport const getUserOrders = async (userId) => {\n  const q = query(\n    collection(db, 'orders'),\n    where('userId', '==', userId)\n  );\n  const snapshot = await getDocs(q);\n  const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n  // Sort by createdAt in JavaScript to avoid needing a composite index\n  return orders.sort((a, b) => {\n    const aTime = a.createdAt?.toDate?.() || a.createdAt || new Date(0);\n    const bTime = b.createdAt?.toDate?.() || b.createdAt || new Date(0);\n    return bTime - aTime; // Descending order (newest first)\n  });\n};\n\n// ✅ Get order by ID\nexport const getOrderById = async (orderId) => {\n  return await getDocument('orders', orderId);\n};\n\n// ✅ Update order status\nexport const updateOrderStatus = async (orderId, status) => {\n  await updateDocument('orders', orderId, { status });\n};\n\n// ✅ Get all orders (for admin)\nexport const getAllOrders = async (limitCount = 50) => {\n  const q = query(\n    collection(db, 'orders'),\n    orderBy('createdAt', 'desc'),\n    limit(limitCount)\n  );\n  const snapshot = await getDocs(q);\n  return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n};\n\n// ✅ Get orders by status\nexport const getOrdersByStatus = async (status) => {\n  const q = query(\n    collection(db, 'orders'),\n    where('status', '==', status)\n  );\n  const snapshot = await getDocs(q);\n  const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n  // Sort by createdAt in JavaScript to avoid needing a composite index\n  return orders.sort((a, b) => {\n    const aTime = a.createdAt?.toDate?.() || a.createdAt || new Date(0);\n    const bTime = b.createdAt?.toDate?.() || b.createdAt || new Date(0);\n    return bTime - aTime; // Descending order (newest first)\n  });\n};\n\n// ✅ Real-time order tracking\nexport const subscribeToOrder = (orderId, callback) => {\n  const docRef = doc(db, 'orders', orderId);\n  return onSnapshot(docRef, (doc) => {\n    if (doc.exists()) {\n      callback({ id: doc.id, ...doc.data() });\n    }\n  });\n};\n\n// ✅ Real-time user orders tracking\nexport const subscribeToUserOrders = (userId, callback) => {\n  if (isDev) {\n    // eslint-disable-next-line no-console\n    console.log('Firebase subscribeToUserOrders: Setting up query for userId:', userId);\n  }\n  // Proxy unsubscribe to keep the same return type while we ensure auth first\n  let innerUnsub = () => {};\n\n  (async () => {\n    try {\n      // Ensure there is an auth context before opening a watch stream (rules require signed-in user)\n      await ensureFirebaseAuth();\n      const auth = getAuth(app);\n      const currentUid = auth.currentUser?.uid || null;\n\n      // Prefer secure filter by authUid (the Firebase UID stored on the order).\n      // Fallback to userId equality if authUid is not available (legacy data).\n      const base = collection(db, 'orders');\n      const q = currentUid\n        ? query(base, where('authUid', '==', currentUid))\n        : query(base, where('userId', '==', userId));\n      innerUnsub = onSnapshot(q, (snapshot) => {\n        if (isDev) {\n          // eslint-disable-next-line no-console\n          console.log('Firebase subscribeToUserOrders: Snapshot received, docs count:', snapshot.docs.length);\n        }\n        const orders = snapshot.docs.map(doc => {\n          const data = { id: doc.id, ...doc.data() };\n          if (isDev) {\n            // eslint-disable-next-line no-console\n            console.log('Firebase subscribeToUserOrders: Order doc:', doc.id, data);\n          }\n          return data;\n        });\n        // Sort by createdAt in JavaScript to avoid needing a composite index\n        const sortedOrders = orders.sort((a, b) => {\n          const aTime = a.createdAt?.toDate?.() || a.createdAt || new Date(0);\n          const bTime = b.createdAt?.toDate?.() || b.createdAt || new Date(0);\n          return bTime - aTime; // Descending order (newest first)\n        });\n        if (isDev) {\n          // eslint-disable-next-line no-console\n          console.log('Firebase subscribeToUserOrders: Returning sorted orders:', sortedOrders.length, 'orders');\n        }\n        callback(sortedOrders);\n      }, (error) => {\n        console.error('Firebase subscribeToUserOrders: Error in snapshot listener:', error);\n      });\n    } catch (e) {\n      console.error('Firebase subscribeToUserOrders: Failed to ensure auth or attach listener:', e);\n    }\n  })();\n\n  return () => {\n    try { innerUnsub(); } catch (e) {}\n  };\n};\n\n// ===== MENU FUNCTIONS =====\n\n// ✅ Get menu items\nexport const getMenuItems = async () => {\n  try {\n    const items = await getCollection('menuItems');\n    if (Array.isArray(items) && items.length > 0) return items;\n  } catch (e) {\n    // fall through to fallback\n  }\n  try {\n    // Fallback to legacy collection name (lowercase)\n    const items = await getCollection('menu');\n    if (Array.isArray(items) && items.length > 0) return items;\n  } catch (e) {\n    // fall through\n  }\n  // Final fallback to capitalized collection name\n  return await getCollection('Menu');\n};\n\n// ✅ Get menu item by ID\nexport const getMenuItem = async (itemId) => {\n  return await getDocument('menuItems', itemId);\n};\n\n// ✅ Get popular menu items\nexport const getPopularMenuItems = async () => {\n  try {\n    // Try different possible collection names\n    const possibleCollections = ['popularMenu', 'popular-menu', 'popular menu', 'popular_items', 'popularItems'];\n    \n    for (const collectionName of possibleCollections) {\n      try {\n        const items = await getCollection(collectionName);\n        if (items && items.length > 0) {\n          if (isDev) {\n            // eslint-disable-next-line no-console\n            console.log(`Found popular items in collection: ${collectionName}`, items);\n          }\n          // Ensure each item has a valid image URL\n          return items.map(item => ({\n            ...item,\n            image: item.image || '/placeholder-dish.png' // Fallback image\n          }));\n        }\n      } catch (e) {\n        if (isDev) {\n          // eslint-disable-next-line no-console\n          console.log(`Collection ${collectionName} not found, trying next...`);\n        }\n      }\n    }\n    \n    // If no collection found, return fallback data\n    if (isDev) {\n      // eslint-disable-next-line no-console\n      console.warn('No popular menu items found in any collection. Using fallback data.');\n    }\n    return [\n      {\n        id: 'fallback-1',\n        name: 'Chicken Biriyani',\n        description: 'Aromatic chicken biriyani',\n        price: 99,\n        rating: 4.8,\n        deliveryTime: '30-40 min',\n        isVeg: false,\n        image: '/chicken-biriyani.jpeg'\n      },\n      {\n        id: 'fallback-2',\n        name: 'Mutton Biriyani',\n        description: 'Aromatic mutton biriyani',\n        price: 179,\n        rating: 4.7,\n        deliveryTime: '25-35 min',\n        isVeg: true,\n        image: '/mutton-biriyani.jpeg'\n      }\n    ];\n  } catch (error) {\n    console.error('Error in getPopularMenuItems:', error);\n    return [];\n  }\n};\n\n// ===== OFFERS (PROMOTIONS) =====\n\n// Get all offers\nexport const getOffers = async () => {\n  return await getCollection('offers');\n};\n\n// Real-time offers subscription\nexport const subscribeToOffers = (callback) => {\n  const colRef = collection(db, 'offers');\n  return onSnapshot(colRef, (snapshot) => {\n    const items = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));\n    callback(items);\n  });\n};\n\n// ===== USER FUNCTIONS =====\n\n// ✅ Create or update user profile\nexport const saveUserProfile = async (userId, userData) => {\n  const userRef = doc(db, 'users', userId);\n  const userSnap = await getDoc(userRef);\n  \n  if (userSnap.exists()) {\n    // Update existing user\n    await updateDoc(userRef, {\n      ...userData,\n      updatedAt: serverTimestamp()\n    });\n  } else {\n    // Create new user with userId as document ID\n    await setDoc(userRef, {\n      ...userData,\n      userId,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp()\n    });\n  }\n};\n\n// ✅ Get user profile\nexport const getUserProfile = async (userId) => {\n  // Ensure there is an auth context for rules that require signed-in users\n  await ensureFirebaseAuth();\n  const userRef = doc(db, 'users', userId);\n  const userSnap = await getDoc(userRef);\n  \n  if (userSnap.exists()) {\n    return { id: userSnap.id, ...userSnap.data() };\n  }\n  return null;\n};\n\nexport { db };\n\n// ===== APP STATUS (OPEN/CLOSE) =====\n\n// Real-time subscription to app open/close status\nexport const subscribeToAppStatus = (callback) => {\n  const statusRef = doc(db, 'settings', 'appStatus');\n  return onSnapshot(statusRef, (snap) => {\n    if (snap.exists()) {\n      const data = snap.data();\n      callback({ isOpen: data.isOpen !== false, message: data.message || '' });\n    } else {\n      // Default to open if doc missing\n      callback({ isOpen: true, message: '' });\n    }\n  }, (error) => {\n    console.error('[Firestore] subscribeToAppStatus error:', error);\n    // On error, default to open to avoid blocking users\n    callback({ isOpen: true, message: '' });\n  });\n};\n\n// Update app open/close status\nexport const setAppStatus = async ({ isOpen, message }, user) => {\n  await ensureFirebaseAuth();\n  const statusRef = doc(db, 'settings', 'appStatus');\n  await setDoc(statusRef, {\n    isOpen: Boolean(isOpen),\n    message: message || '',\n    updatedAt: serverTimestamp(),\n    updatedBy: user?.email || user?.uid || 'system'\n  }, { merge: true });\n};\n\n// ===== SUPPORT (TICKETS) =====\n\n// Create a support ticket\nexport const createSupportTicket = async (ticket) => {\n  await ensureFirebaseAuth();\n  const payload = {\n    status: 'open',\n    source: 'web',\n    ...ticket,\n    createdAt: serverTimestamp(),\n    updatedAt: serverTimestamp(),\n  };\n  const ref = await addDoc(collection(db, 'supportTickets'), payload);\n  return ref.id;\n};\n\n// Get support tickets for a user\nexport const getUserSupportTickets = async (userId) => {\n  const q = query(\n    collection(db, 'supportTickets'),\n    where('userId', '==', userId)\n  );\n  const snapshot = await getDocs(q);\n  const items = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));\n  return items.sort((a, b) => {\n    const at = a.createdAt?.toDate?.() || a.createdAt || new Date(0);\n    const bt = b.createdAt?.toDate?.() || b.createdAt || new Date(0);\n    return bt - at;\n  });\n};\n\n// Subscribe to user's support tickets\nexport const subscribeToUserSupportTickets = (userId, callback) => {\n  const q = query(\n    collection(db, 'supportTickets'),\n    where('userId', '==', userId)\n  );\n  return onSnapshot(q, (snapshot) => {\n    const items = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));\n    const sorted = items.sort((a, b) => {\n      const at = a.createdAt?.toDate?.() || a.createdAt || new Date(0);\n      const bt = b.createdAt?.toDate?.() || b.createdAt || new Date(0);\n      return bt - at;\n    });\n    callback(sorted);\n  });\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}