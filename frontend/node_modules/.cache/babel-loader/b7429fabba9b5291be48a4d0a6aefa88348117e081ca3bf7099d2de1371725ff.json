{"ast":null,"code":"import _objectSpread from\"/Users/chandrilmallick/Downloads/web-projects/dabba-app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/services/supabaseAuthService.js\n// Lightweight phone OTP service using Supabase Auth\n// Usage:\n//   import supabaseAuth from './supabaseAuthService'\n//   const { success, error } = await supabaseAuth.sendOTP('+919876543210')\n//   const { success, user, session, error } = await supabaseAuth.verifyOTP('+919876543210', '123456')\nimport{supabase}from'../lib/supabaseClient';import{db,auth as firebaseAuth}from'../firebase/config';let _anonAuthStarted=false;const ensureFirebaseAuth=async()=>{if(_anonAuthStarted)return;_anonAuthStarted=true;try{const{signInAnonymously,onAuthStateChanged}=await import('firebase/auth');// If already signed in, skip\nif(firebaseAuth.currentUser)return;await signInAnonymously(firebaseAuth);// Optionally wait for state\nawait new Promise(resolve=>{const unsub=onAuthStateChanged(firebaseAuth,()=>{unsub();resolve();});});}catch(e){// eslint-disable-next-line no-console\nconsole.warn('[Supabase] Anonymous Firebase auth failed (Firestore may require auth):',e===null||e===void 0?void 0:e.message);}};const normalizePhone=phone=>{const digitsOnly=String(phone||'').replace(/\\D/g,'');if(!digitsOnly)return'';if(digitsOnly.startsWith('91'))return\"+\".concat(digitsOnly);// already has country code\nif(String(phone).startsWith('+'))return\"+\".concat(digitsOnly);return\"+91\".concat(digitsOnly);// default India\n};class SupabaseAuthService{// Send OTP via SMS\nasync sendOTP(phone){const formatted=normalizePhone(phone);if(!formatted){return{success:false,error:'Please enter a valid phone number'};}// Helpful debug log in development\nif(process.env.NODE_ENV!=='production'){// eslint-disable-next-line no-console\nconsole.debug('[Supabase] Sending OTP to',formatted);}const options={// 60s default. You can raise on server side in Supabase Auth settings.\nshouldCreateUser:true};// Only force SMS channel if explicitly enabled via env and provider is configured\nif(process.env.REACT_APP_SUPABASE_USE_SMS_CHANNEL==='true'){options.channel='sms';}const{data,error}=await supabase.auth.signInWithOtp({phone:formatted,options});if(error){if(process.env.NODE_ENV!=='production'){// eslint-disable-next-line no-console\nconsole.error('[Supabase] signInWithOtp error',{status:error.status,message:error.message,phone:formatted});}// Provide actionable guidance for common 400 issues\nlet message=error.message||'Failed to send OTP';if(String(error.message).toLowerCase().includes('phone')){message='Invalid phone number. Use full number with country code, e.g. +919733960909';}// When using Test Phone Numbers in Supabase, ensure mapping includes country code without plus, e.g. 919733960909=123456\nif(error.status===400){message+=' • Check Supabase Auth: Providers → Phone is enabled and SMS provider or Test Phone Numbers are configured (use 919...=123456 for India)';}if(String(error.message).toLowerCase().includes('unsupported phone provider')){message='Unsupported phone provider. Either configure an SMS provider (Twilio) in Supabase Auth or remove forcing the SMS channel. You can enable SMS channel by setting REACT_APP_SUPABASE_USE_SMS_CHANNEL=true (requires dev server restart). For testing without Twilio, keep it false and use Test Phone Numbers.';}if(process.env.NODE_ENV!=='production'){message+=\" \\u2022 Sent phone: \".concat(formatted);}return{success:false,error:message};}return{success:true,data};}// Verify the OTP and sign in\nasync verifyOTP(phone,token){let additionalData=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const formatted=normalizePhone(phone);if(!formatted||!token){return{success:false,error:'Phone and OTP are required'};}const{data,error}=await supabase.auth.verifyOtp({phone:formatted,token,type:'sms'});if(error){return{success:false,error:error.message};}const{user,session}=data||{};// Optionally create/update a profile in Firestore to match your existing schema\nif(db&&user!==null&&user!==void 0&&user.id){try{await ensureFirebaseAuth();// dynamic import to avoid hard dependency when Firebase isn't present\nconst{doc,getDoc,setDoc,updateDoc}=await import('firebase/firestore');const userRef=doc(db,'users',user.id);const snap=await getDoc(userRef);const payload=_objectSpread({uid:user.id,phoneNumber:user.phone,lastLogin:new Date(),updatedAt:new Date(),// Tie this Supabase user doc to the current Firebase (anonymous) auth uid for Firestore rules\nauthUid:firebaseAuth.currentUser?firebaseAuth.currentUser.uid:undefined},additionalData);if(!snap.exists()){await setDoc(userRef,_objectSpread(_objectSpread({},payload),{},{createdAt:new Date(),addresses:[],orderHistory:[]}));}else{await updateDoc(userRef,payload);}}catch(profileErr){// eslint-disable-next-line no-console\nconsole.warn('[Supabase] Skipped Firestore profile sync:',profileErr===null||profileErr===void 0?void 0:profileErr.message);}}return{success:true,user,session};}// Get current Supabase session/user\nasync getSession(){const{data}=await supabase.auth.getSession();return(data===null||data===void 0?void 0:data.session)||null;}async getUser(){const{data}=await supabase.auth.getUser();return(data===null||data===void 0?void 0:data.user)||null;}async signOut(){const{error}=await supabase.auth.signOut();if(error)return{success:false,error:error.message};return{success:true};}// Auth state listener compatible with Firebase\nonAuthStateChanged(callback){// Get initial session\nthis.getUser().then(user=>{callback(user);});// Listen for auth changes\nconst{data:{subscription}}=supabase.auth.onAuthStateChange((event,session)=>{callback((session===null||session===void 0?void 0:session.user)||null);});// Return unsubscribe function\nreturn()=>{subscription.unsubscribe();};}// User profile management methods (compatible with Firebase structure)\nasync getUserProfile(userId){if(!db){var _user$user_metadata;// If no Firebase, return basic profile from Supabase user\nconst user=await this.getUser();return user?{uid:user.id,phoneNumber:user.phone,displayName:((_user$user_metadata=user.user_metadata)===null||_user$user_metadata===void 0?void 0:_user$user_metadata.displayName)||'',addresses:[],orderHistory:[]}:null;}try{// Ensure we are signed into Firebase (anonymous) before reading\nawait ensureFirebaseAuth();const{doc,getDoc}=await import('firebase/firestore');const userRef=doc(db,'users',userId);const snap=await getDoc(userRef);return snap.exists()?snap.data():null;}catch(error){console.error('Error getting user profile:',error);return null;}}async updateUserProfile(userId,profileData){if(!db){return{success:false,error:'Firestore not available'};}try{await ensureFirebaseAuth();const{doc,setDoc}=await import('firebase/firestore');const userRef=doc(db,'users',userId);const payload=_objectSpread(_objectSpread({},profileData),{},{updatedAt:new Date(),// Ensure authUid present when creating via merge (satisfies create rule)\nauthUid:firebaseAuth.currentUser?firebaseAuth.currentUser.uid:undefined});await setDoc(userRef,payload,{merge:true});return{success:true};}catch(error){console.error('Error updating user profile:',error);return{success:false,error:error.message};}}async addAddress(userId,address){if(!db){return{success:false,error:'Firestore not available'};}try{await ensureFirebaseAuth();const{doc,getDoc,setDoc,updateDoc,arrayUnion}=await import('firebase/firestore');const userRef=doc(db,'users',userId);const snap=await getDoc(userRef);if(!snap.exists()){await setDoc(userRef,{addresses:[address],updatedAt:new Date(),createdAt:new Date(),authUid:firebaseAuth.currentUser?firebaseAuth.currentUser.uid:undefined},{merge:true});}else{await updateDoc(userRef,{addresses:arrayUnion(address),updatedAt:new Date()});}return{success:true};}catch(error){console.error('Error adding address:',error);return{success:false,error:error.message};}}// Alias for signOut to match Firebase interface\nasync logout(){return await this.signOut();}// Cleanup method (no-op for Supabase)\ncleanup(){// No cleanup needed for Supabase\n}}const supabaseAuth=new SupabaseAuthService();export default supabaseAuth;","map":{"version":3,"names":["supabase","db","auth","firebaseAuth","_anonAuthStarted","ensureFirebaseAuth","signInAnonymously","onAuthStateChanged","currentUser","Promise","resolve","unsub","e","console","warn","message","normalizePhone","phone","digitsOnly","String","replace","startsWith","concat","SupabaseAuthService","sendOTP","formatted","success","error","process","env","NODE_ENV","debug","options","shouldCreateUser","REACT_APP_SUPABASE_USE_SMS_CHANNEL","channel","data","signInWithOtp","status","toLowerCase","includes","verifyOTP","token","additionalData","arguments","length","undefined","verifyOtp","type","user","session","id","doc","getDoc","setDoc","updateDoc","userRef","snap","payload","_objectSpread","uid","phoneNumber","lastLogin","Date","updatedAt","authUid","exists","createdAt","addresses","orderHistory","profileErr","getSession","getUser","signOut","callback","then","subscription","onAuthStateChange","event","unsubscribe","getUserProfile","userId","_user$user_metadata","displayName","user_metadata","updateUserProfile","profileData","merge","addAddress","address","arrayUnion","logout","cleanup","supabaseAuth"],"sources":["/Users/chandrilmallick/Downloads/web-projects/dabba-app/frontend/src/services/supabaseAuthService.js"],"sourcesContent":["// src/services/supabaseAuthService.js\n// Lightweight phone OTP service using Supabase Auth\n// Usage:\n//   import supabaseAuth from './supabaseAuthService'\n//   const { success, error } = await supabaseAuth.sendOTP('+919876543210')\n//   const { success, user, session, error } = await supabaseAuth.verifyOTP('+919876543210', '123456')\n\nimport { supabase } from '../lib/supabaseClient'\nimport { db, auth as firebaseAuth } from '../firebase/config'\n\nlet _anonAuthStarted = false\nconst ensureFirebaseAuth = async () => {\n  if (_anonAuthStarted) return\n  _anonAuthStarted = true\n  try {\n    const { signInAnonymously, onAuthStateChanged } = await import('firebase/auth')\n    // If already signed in, skip\n    if (firebaseAuth.currentUser) return\n    await signInAnonymously(firebaseAuth)\n    // Optionally wait for state\n    await new Promise((resolve) => {\n      const unsub = onAuthStateChanged(firebaseAuth, () => {\n        unsub()\n        resolve()\n      })\n    })\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.warn('[Supabase] Anonymous Firebase auth failed (Firestore may require auth):', e?.message)\n  }\n}\n\nconst normalizePhone = (phone) => {\n  const digitsOnly = String(phone || '').replace(/\\D/g, '')\n  if (!digitsOnly) return ''\n\n  if (digitsOnly.startsWith('91')) return `+${digitsOnly}` // already has country code\n  if (String(phone).startsWith('+')) return `+${digitsOnly}`\n  return `+91${digitsOnly}` // default India\n}\n\nclass SupabaseAuthService {\n  // Send OTP via SMS\n  async sendOTP(phone) {\n    const formatted = normalizePhone(phone)\n    if (!formatted) {\n      return { success: false, error: 'Please enter a valid phone number' }\n    }\n\n    // Helpful debug log in development\n    if (process.env.NODE_ENV !== 'production') {\n      // eslint-disable-next-line no-console\n      console.debug('[Supabase] Sending OTP to', formatted)\n    }\n\n    const options = {\n      // 60s default. You can raise on server side in Supabase Auth settings.\n      shouldCreateUser: true\n    }\n    // Only force SMS channel if explicitly enabled via env and provider is configured\n    if (process.env.REACT_APP_SUPABASE_USE_SMS_CHANNEL === 'true') {\n      options.channel = 'sms'\n    }\n\n    const { data, error } = await supabase.auth.signInWithOtp({\n      phone: formatted,\n      options\n    })\n\n    if (error) {\n      if (process.env.NODE_ENV !== 'production') {\n        // eslint-disable-next-line no-console\n        console.error('[Supabase] signInWithOtp error', { status: error.status, message: error.message, phone: formatted })\n      }\n      // Provide actionable guidance for common 400 issues\n      let message = error.message || 'Failed to send OTP'\n      if (String(error.message).toLowerCase().includes('phone')) {\n        message = 'Invalid phone number. Use full number with country code, e.g. +919733960909'\n      }\n      // When using Test Phone Numbers in Supabase, ensure mapping includes country code without plus, e.g. 919733960909=123456\n      if (error.status === 400) {\n        message += ' • Check Supabase Auth: Providers → Phone is enabled and SMS provider or Test Phone Numbers are configured (use 919...=123456 for India)'\n      }\n      if (String(error.message).toLowerCase().includes('unsupported phone provider')) {\n        message = 'Unsupported phone provider. Either configure an SMS provider (Twilio) in Supabase Auth or remove forcing the SMS channel. You can enable SMS channel by setting REACT_APP_SUPABASE_USE_SMS_CHANNEL=true (requires dev server restart). For testing without Twilio, keep it false and use Test Phone Numbers.'\n      }\n      if (process.env.NODE_ENV !== 'production') {\n        message += ` • Sent phone: ${formatted}`\n      }\n      return { success: false, error: message }\n    }\n\n    return { success: true, data }\n  }\n\n  // Verify the OTP and sign in\n  async verifyOTP(phone, token, additionalData = {}) {\n    const formatted = normalizePhone(phone)\n    if (!formatted || !token) {\n      return { success: false, error: 'Phone and OTP are required' }\n    }\n\n    const { data, error } = await supabase.auth.verifyOtp({\n      phone: formatted,\n      token,\n      type: 'sms'\n    })\n\n    if (error) {\n      return { success: false, error: error.message }\n    }\n\n    const { user, session } = data || {}\n\n    // Optionally create/update a profile in Firestore to match your existing schema\n    if (db && user?.id) {\n      try {\n        await ensureFirebaseAuth()\n        // dynamic import to avoid hard dependency when Firebase isn't present\n        const { doc, getDoc, setDoc, updateDoc } = await import('firebase/firestore')\n        const userRef = doc(db, 'users', user.id)\n        const snap = await getDoc(userRef)\n        const payload = {\n          uid: user.id,\n          phoneNumber: user.phone,\n          lastLogin: new Date(),\n          updatedAt: new Date(),\n          // Tie this Supabase user doc to the current Firebase (anonymous) auth uid for Firestore rules\n          authUid: firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : undefined,\n          ...additionalData\n        }\n        if (!snap.exists()) {\n          await setDoc(userRef, { ...payload, createdAt: new Date(), addresses: [], orderHistory: [] })\n        } else {\n          await updateDoc(userRef, payload)\n        }\n      } catch (profileErr) {\n        // eslint-disable-next-line no-console\n        console.warn('[Supabase] Skipped Firestore profile sync:', profileErr?.message)\n      }\n    }\n\n    return { success: true, user, session }\n  }\n\n  // Get current Supabase session/user\n  async getSession() {\n    const { data } = await supabase.auth.getSession()\n    return data?.session || null\n  }\n\n  async getUser() {\n    const { data } = await supabase.auth.getUser()\n    return data?.user || null\n  }\n\n  async signOut() {\n    const { error } = await supabase.auth.signOut()\n    if (error) return { success: false, error: error.message }\n    return { success: true }\n  }\n\n  // Auth state listener compatible with Firebase\n  onAuthStateChanged(callback) {\n    // Get initial session\n    this.getUser().then(user => {\n      callback(user);\n    });\n\n    // Listen for auth changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\n      callback(session?.user || null);\n    });\n\n    // Return unsubscribe function\n    return () => {\n      subscription.unsubscribe();\n    };\n  }\n\n  // User profile management methods (compatible with Firebase structure)\n  async getUserProfile(userId) {\n    if (!db) {\n      // If no Firebase, return basic profile from Supabase user\n      const user = await this.getUser();\n      return user ? {\n        uid: user.id,\n        phoneNumber: user.phone,\n        displayName: user.user_metadata?.displayName || '',\n        addresses: [],\n        orderHistory: []\n      } : null;\n    }\n\n    try {\n      // Ensure we are signed into Firebase (anonymous) before reading\n      await ensureFirebaseAuth()\n      const { doc, getDoc } = await import('firebase/firestore');\n      const userRef = doc(db, 'users', userId);\n      const snap = await getDoc(userRef);\n      return snap.exists() ? snap.data() : null;\n    } catch (error) {\n      console.error('Error getting user profile:', error);\n      return null;\n    }\n  }\n\n  async updateUserProfile(userId, profileData) {\n    if (!db) {\n      return { success: false, error: 'Firestore not available' };\n    }\n\n    try {\n      await ensureFirebaseAuth()\n      const { doc, setDoc } = await import('firebase/firestore');\n      const userRef = doc(db, 'users', userId);\n      const payload = {\n        ...profileData,\n        updatedAt: new Date(),\n        // Ensure authUid present when creating via merge (satisfies create rule)\n        authUid: firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : undefined\n      };\n      await setDoc(userRef, payload, { merge: true });\n      return { success: true };\n    } catch (error) {\n      console.error('Error updating user profile:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  async addAddress(userId, address) {\n    if (!db) {\n      return { success: false, error: 'Firestore not available' };\n    }\n\n    try {\n      await ensureFirebaseAuth()\n      const { doc, getDoc, setDoc, updateDoc, arrayUnion } = await import('firebase/firestore');\n      const userRef = doc(db, 'users', userId);\n      const snap = await getDoc(userRef);\n      if (!snap.exists()) {\n        await setDoc(\n          userRef,\n          {\n            addresses: [address],\n            updatedAt: new Date(),\n            createdAt: new Date(),\n            authUid: firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : undefined\n          },\n          { merge: true }\n        );\n      } else {\n        await updateDoc(userRef, {\n          addresses: arrayUnion(address),\n          updatedAt: new Date()\n        });\n      }\n      return { success: true };\n    } catch (error) {\n      console.error('Error adding address:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  // Alias for signOut to match Firebase interface\n  async logout() {\n    return await this.signOut();\n  }\n\n  // Cleanup method (no-op for Supabase)\n  cleanup() {\n    // No cleanup needed for Supabase\n  }\n}\n\nconst supabaseAuth = new SupabaseAuthService()\nexport default supabaseAuth\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}