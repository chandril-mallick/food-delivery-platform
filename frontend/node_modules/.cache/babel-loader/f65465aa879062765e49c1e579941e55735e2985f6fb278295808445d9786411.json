{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[userProfile,setUserProfile]=useState(null);const[loading,setLoading]=useState(true);const[isAuthenticated,setIsAuthenticated]=useState(false);// Dynamic provider selection based on environment\nconst provider=process.env.REACT_APP_AUTH_PROVIDER||'firebase';// Dynamic import of auth service based on provider\nconst[authService,setAuthService]=useState(null);useEffect(()=>{const loadAuthService=async()=>{try{if(provider==='supabase'){const{default:supabaseAuthService}=await import('../services/supabaseAuthService');setAuthService(supabaseAuthService);}else{const{default:firebaseAuthService}=await import('../services/authService');setAuthService(firebaseAuthService);}}catch(error){console.error('Error loading auth service:',error);setLoading(false);}};loadAuthService();},[provider]);useEffect(()=>{if(!authService)return;let unsubscribe;const setupAuthListener=async()=>{try{if(provider==='supabase'){// Supabase auth state listener\nunsubscribe=await authService.onAuthStateChanged(async currentUser=>{setUser(currentUser);setIsAuthenticated(!!currentUser);if(currentUser){try{const profile=await authService.getUserProfile(currentUser.id);setUserProfile(profile);}catch(error){console.error('Error fetching user profile:',error);}}else{setUserProfile(null);}setLoading(false);});}else{// Firebase auth state listener\nunsubscribe=authService.onAuthStateChanged(async currentUser=>{setUser(currentUser);setIsAuthenticated(!!currentUser);if(currentUser){try{const profile=await authService.getUserProfile(currentUser.uid);setUserProfile(profile);}catch(error){console.error('Error fetching user profile:',error);}}else{setUserProfile(null);}setLoading(false);});}}catch(error){console.error('Error setting up auth listener:',error);setLoading(false);}};setupAuthListener();return()=>{if(unsubscribe){if(typeof unsubscribe==='function'){unsubscribe();}else if(unsubscribe.unsubscribe){unsubscribe.unsubscribe();}}if(authService.cleanup){authService.cleanup();}};},[authService,provider]);// Send OTP to phone number\nconst sendOTP=async phoneNumber=>{if(!authService){return{success:false,error:'Auth service not loaded'};}return await authService.sendOTP(phoneNumber);};// Verify OTP and complete login\nconst verifyOTP=async(arg1,otp)=>{if(!authService){return{success:false,error:'Auth service not loaded'};}if(provider==='supabase'){// For Supabase: arg1 is phone number\nconst result=await authService.verifyOTP(arg1,otp);if(result.success){// User will be set via auth state listener\n}return result;}else{// For Firebase: arg1 is confirmationResult\nconst result=await authService.verifyOTP(arg1,otp);if(result.success){// User will be set via auth state listener\n}return result;}};// Update user profile\nconst updateProfile=async profileData=>{if(!user||!authService)return{success:false,error:'User not authenticated or auth service not loaded'};const userId=provider==='supabase'?user.id:user.uid;const result=await authService.updateUserProfile(userId,profileData);if(result.success){const updatedProfile=await authService.getUserProfile(userId);setUserProfile(updatedProfile);}return result;};// Add address\nconst addAddress=async address=>{if(!user||!authService)return{success:false,error:'User not authenticated or auth service not loaded'};const userId=provider==='supabase'?user.id:user.uid;const result=await authService.addAddress(userId,address);if(result.success){const updatedProfile=await authService.getUserProfile(userId);setUserProfile(updatedProfile);}return result;};// Logout\nconst logout=async()=>{if(!authService)return{success:false,error:'Auth service not loaded'};const result=await authService.logout();if(result.success){setUser(null);setUserProfile(null);setIsAuthenticated(false);}return result;};// Check if user is authenticated (for order protection)\nconst requireAuth=()=>{return isAuthenticated;};const value={user,userProfile,isAuthenticated,loading,provider,sendOTP,verifyOTP,updateProfile,addAddress,logout,requireAuth};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","user","setUser","userProfile","setUserProfile","loading","setLoading","isAuthenticated","setIsAuthenticated","provider","process","env","REACT_APP_AUTH_PROVIDER","authService","setAuthService","loadAuthService","default","supabaseAuthService","firebaseAuthService","error","console","unsubscribe","setupAuthListener","onAuthStateChanged","currentUser","profile","getUserProfile","id","uid","cleanup","sendOTP","phoneNumber","success","verifyOTP","arg1","otp","result","updateProfile","profileData","userId","updateUserProfile","updatedProfile","addAddress","address","logout","requireAuth","value","Provider"],"sources":["/Users/chandrilmallick/Downloads/web-projects/dabba-app/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\n\nconst AuthContext = createContext();\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  \n  // Dynamic provider selection based on environment\n  const provider = process.env.REACT_APP_AUTH_PROVIDER || 'firebase';\n  \n  // Dynamic import of auth service based on provider\n  const [authService, setAuthService] = useState(null);\n\n  useEffect(() => {\n    const loadAuthService = async () => {\n      try {\n        if (provider === 'supabase') {\n          const { default: supabaseAuthService } = await import('../services/supabaseAuthService');\n          setAuthService(supabaseAuthService);\n        } else {\n          const { default: firebaseAuthService } = await import('../services/authService');\n          setAuthService(firebaseAuthService);\n        }\n      } catch (error) {\n        console.error('Error loading auth service:', error);\n        setLoading(false);\n      }\n    };\n\n    loadAuthService();\n  }, [provider]);\n\n  useEffect(() => {\n    if (!authService) return;\n\n    let unsubscribe;\n\n    const setupAuthListener = async () => {\n      try {\n        if (provider === 'supabase') {\n          // Supabase auth state listener\n          unsubscribe = await authService.onAuthStateChanged(async (currentUser) => {\n            setUser(currentUser);\n            setIsAuthenticated(!!currentUser);\n\n            if (currentUser) {\n              try {\n                const profile = await authService.getUserProfile(currentUser.id);\n                setUserProfile(profile);\n              } catch (error) {\n                console.error('Error fetching user profile:', error);\n              }\n            } else {\n              setUserProfile(null);\n            }\n\n            setLoading(false);\n          });\n        } else {\n          // Firebase auth state listener\n          unsubscribe = authService.onAuthStateChanged(async (currentUser) => {\n            setUser(currentUser);\n            setIsAuthenticated(!!currentUser);\n\n            if (currentUser) {\n              try {\n                const profile = await authService.getUserProfile(currentUser.uid);\n                setUserProfile(profile);\n              } catch (error) {\n                console.error('Error fetching user profile:', error);\n              }\n            } else {\n              setUserProfile(null);\n            }\n\n            setLoading(false);\n          });\n        }\n      } catch (error) {\n        console.error('Error setting up auth listener:', error);\n        setLoading(false);\n      }\n    };\n\n    setupAuthListener();\n\n    return () => {\n      if (unsubscribe) {\n        if (typeof unsubscribe === 'function') {\n          unsubscribe();\n        } else if (unsubscribe.unsubscribe) {\n          unsubscribe.unsubscribe();\n        }\n      }\n      if (authService.cleanup) {\n        authService.cleanup();\n      }\n    };\n  }, [authService, provider]);\n\n  // Send OTP to phone number\n  const sendOTP = async (phoneNumber) => {\n    if (!authService) {\n      return { success: false, error: 'Auth service not loaded' };\n    }\n    return await authService.sendOTP(phoneNumber);\n  };\n\n  // Verify OTP and complete login\n  const verifyOTP = async (arg1, otp) => {\n    if (!authService) {\n      return { success: false, error: 'Auth service not loaded' };\n    }\n    \n    if (provider === 'supabase') {\n      // For Supabase: arg1 is phone number\n      const result = await authService.verifyOTP(arg1, otp);\n      if (result.success) {\n        // User will be set via auth state listener\n      }\n      return result;\n    } else {\n      // For Firebase: arg1 is confirmationResult\n      const result = await authService.verifyOTP(arg1, otp);\n      if (result.success) {\n        // User will be set via auth state listener\n      }\n      return result;\n    }\n  };\n\n  // Update user profile\n  const updateProfile = async (profileData) => {\n    if (!user || !authService) return { success: false, error: 'User not authenticated or auth service not loaded' };\n    \n    const userId = provider === 'supabase' ? user.id : user.uid;\n    const result = await authService.updateUserProfile(userId, profileData);\n    if (result.success) {\n      const updatedProfile = await authService.getUserProfile(userId);\n      setUserProfile(updatedProfile);\n    }\n    return result;\n  };\n\n  // Add address\n  const addAddress = async (address) => {\n    if (!user || !authService) return { success: false, error: 'User not authenticated or auth service not loaded' };\n    \n    const userId = provider === 'supabase' ? user.id : user.uid;\n    const result = await authService.addAddress(userId, address);\n    if (result.success) {\n      const updatedProfile = await authService.getUserProfile(userId);\n      setUserProfile(updatedProfile);\n    }\n    return result;\n  };\n\n  // Logout\n  const logout = async () => {\n    if (!authService) return { success: false, error: 'Auth service not loaded' };\n    \n    const result = await authService.logout();\n    if (result.success) {\n      setUser(null);\n      setUserProfile(null);\n      setIsAuthenticated(false);\n    }\n    return result;\n  };\n\n  // Check if user is authenticated (for order protection)\n  const requireAuth = () => {\n    return isAuthenticated;\n  };\n\n  const value = {\n    user,\n    userProfile,\n    isAuthenticated,\n    loading,\n    provider,\n    sendOTP,\n    verifyOTP,\n    updateProfile,\n    addAddress,\n    logout,\n    requireAuth\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}