"use strict";(self.webpackChunkdabba_app=self.webpackChunkdabba_app||[]).push([[47,65],{2446:(e,s,r)=>{r.d(s,{default:()=>c});var t=r(2555),a=r(8047),n=r(347);let o=!1;const i=async()=>{if(!o){o=!0;try{const{signInAnonymously:e,onAuthStateChanged:s}=await Promise.resolve().then(r.bind(r,9786));if(n.j2.currentUser)return;await e(n.j2),await new Promise(e=>{const r=s(n.j2,()=>{r(),e()})})}catch(e){console.warn("[Supabase] Anonymous Firebase auth failed (Firestore may require auth):",null===e||void 0===e?void 0:e.message)}}},u=e=>{const s=String(e||"").replace(/\D/g,"");return s?s.startsWith("91")||String(e).startsWith("+")?"+".concat(s):"+91".concat(s):""};const c=new class{async sendOTP(e){const s=u(e);if(!s)return{success:!1,error:"Please enter a valid phone number"};const r={shouldCreateUser:!0};"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyC6aOy5iTmZvDEK7Dwf5ElSZD7GbSoIs9A",REACT_APP_FIREBASE_AUTH_DOMAIN:"dabbabot-85186.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"dabbabot-85186",REACT_APP_FIREBASE_STORAGE_BUCKET:'dabbabot-85186.appspot.com   # note ".appspot.com"',REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"510798810359",REACT_APP_FIREBASE_APP_ID:"1:510798810359:web:34b36a50c9e9f1709d97f2",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-BJ0PTZR0W7       # optional, for Analytics",REACT_APP_ENABLE_APPCHECK:"false",REACT_APP_AUTH_PROVIDER:"supabase",REACT_APP_SUPABASE_URL:"https://jmmrvgbnendzgpqqwhux.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImptbXJ2Z2JuZW5kemdwcXF3aHV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMjUzODAsImV4cCI6MjA3MDYwMTM4MH0.hpLhW7yUoXQY-jzrWJWCDzDQRpbzQ8sKDiXrMApbYjs"}.REACT_APP_SUPABASE_USE_SMS_CHANNEL&&(r.channel="sms");const{data:t,error:n}=await a.supabase.auth.signInWithOtp({phone:s,options:r});if(n){0;let e=n.message||"Failed to send OTP";return String(n.message).toLowerCase().includes("phone")&&(e="Invalid phone number. Use full number with country code, e.g. +919733960909"),400===n.status&&(e+=" \u2022 Check Supabase Auth: Providers \u2192 Phone is enabled and SMS provider or Test Phone Numbers are configured (use 919...=123456 for India)"),String(n.message).toLowerCase().includes("unsupported phone provider")&&(e="Unsupported phone provider. Either configure an SMS provider (Twilio) in Supabase Auth or remove forcing the SMS channel. You can enable SMS channel by setting REACT_APP_SUPABASE_USE_SMS_CHANNEL=true (requires dev server restart). For testing without Twilio, keep it false and use Test Phone Numbers."),{success:!1,error:e}}return{success:!0,data:t}}async verifyOTP(e,s){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const c=u(e);if(!c||!s)return{success:!1,error:"Phone and OTP are required"};const{data:d,error:p}=await a.supabase.auth.verifyOtp({phone:c,token:s,type:"sms"});if(p)return{success:!1,error:p.message};const{user:l,session:A}=d||{};if(n.db&&null!==l&&void 0!==l&&l.id)try{await i();const{doc:e,getDoc:s,setDoc:a,updateDoc:u}=await Promise.resolve().then(r.bind(r,5472)),c=e(n.db,"users",l.id),d=await s(c),p=(0,t.A)({uid:l.id,phoneNumber:l.phone,lastLogin:new Date,updatedAt:new Date,authUid:n.j2.currentUser?n.j2.currentUser.uid:void 0},o);d.exists()?await u(c,p):await a(c,(0,t.A)((0,t.A)({},p),{},{createdAt:new Date,addresses:[],orderHistory:[]}))}catch(h){console.warn("[Supabase] Skipped Firestore profile sync:",null===h||void 0===h?void 0:h.message)}return{success:!0,user:l,session:A}}async getSession(){const{data:e}=await a.supabase.auth.getSession();return(null===e||void 0===e?void 0:e.session)||null}async getUser(){const{data:e}=await a.supabase.auth.getUser();return(null===e||void 0===e?void 0:e.user)||null}async signOut(){const{error:e}=await a.supabase.auth.signOut();return e?{success:!1,error:e.message}:{success:!0}}onAuthStateChanged(e){this.getUser().then(s=>{e(s)});const{data:{subscription:s}}=a.supabase.auth.onAuthStateChange((s,r)=>{e((null===r||void 0===r?void 0:r.user)||null)});return()=>{s.unsubscribe()}}async getUserProfile(e){if(!n.db){var s;const e=await this.getUser();return e?{uid:e.id,phoneNumber:e.phone,displayName:(null===(s=e.user_metadata)||void 0===s?void 0:s.displayName)||"",addresses:[],orderHistory:[]}:null}try{await i();const{doc:s,getDoc:t}=await Promise.resolve().then(r.bind(r,5472)),a=s(n.db,"users",e),o=await t(a);return o.exists()?o.data():null}catch(t){return console.error("Error getting user profile:",t),null}}async updateUserProfile(e,s){if(!n.db)return{success:!1,error:"Firestore not available"};try{await i();const{doc:a,setDoc:o}=await Promise.resolve().then(r.bind(r,5472)),u=a(n.db,"users",e),c=(0,t.A)((0,t.A)({},s),{},{updatedAt:new Date,authUid:n.j2.currentUser?n.j2.currentUser.uid:void 0});return await o(u,c,{merge:!0}),{success:!0}}catch(a){return console.error("Error updating user profile:",a),{success:!1,error:a.message}}}async addAddress(e,s){if(!n.db)return{success:!1,error:"Firestore not available"};try{await i();const{doc:t,getDoc:a,setDoc:o,updateDoc:u,arrayUnion:c}=await Promise.resolve().then(r.bind(r,5472)),d=t(n.db,"users",e);return(await a(d)).exists()?await u(d,{addresses:c(s),updatedAt:new Date}):await o(d,{addresses:[s],updatedAt:new Date,createdAt:new Date,authUid:n.j2.currentUser?n.j2.currentUser.uid:void 0},{merge:!0}),{success:!0}}catch(t){return console.error("Error adding address:",t),{success:!1,error:t.message}}}async logout(){return await this.signOut()}cleanup(){}}},8047:(e,s,r)=>{r.d(s,{supabase:()=>n});const t="https://jmmrvgbnendzgpqqwhux.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImptbXJ2Z2JuZW5kemdwcXF3aHV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMjUzODAsImV4cCI6MjA3MDYwMTM4MH0.hpLhW7yUoXQY-jzrWJWCDzDQRpbzQ8sKDiXrMApbYjs";const n=(0,r(6069).UU)(t||"",a||"")}}]);
//# sourceMappingURL=65.475a9dfd.chunk.js.map