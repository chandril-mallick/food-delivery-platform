{"version":3,"file":"static/js/65.475a9dfd.chunk.js","mappings":"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","sources":["services/supabaseAuthService.js","lib/supabaseClient.js"],"sourcesContent":["// src/services/supabaseAuthService.js\n// Lightweight phone OTP service using Supabase Auth\n// Usage:\n//   import supabaseAuth from './supabaseAuthService'\n//   const { success, error } = await supabaseAuth.sendOTP('+919876543210')\n//   const { success, user, session, error } = await supabaseAuth.verifyOTP('+919876543210', '123456')\n\nimport { supabase } from '../lib/supabaseClient'\nimport { db, auth as firebaseAuth } from '../firebase/config'\n\nlet _anonAuthStarted = false\nconst ensureFirebaseAuth = async () => {\n  if (_anonAuthStarted) return\n  _anonAuthStarted = true\n  try {\n    const { signInAnonymously, onAuthStateChanged } = await import('firebase/auth')\n    // If already signed in, skip\n    if (firebaseAuth.currentUser) return\n    await signInAnonymously(firebaseAuth)\n    // Optionally wait for state\n    await new Promise((resolve) => {\n      const unsub = onAuthStateChanged(firebaseAuth, () => {\n        unsub()\n        resolve()\n      })\n    })\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.warn('[Supabase] Anonymous Firebase auth failed (Firestore may require auth):', e?.message)\n  }\n}\n\nconst normalizePhone = (phone) => {\n  const digitsOnly = String(phone || '').replace(/\\D/g, '')\n  if (!digitsOnly) return ''\n\n  if (digitsOnly.startsWith('91')) return `+${digitsOnly}` // already has country code\n  if (String(phone).startsWith('+')) return `+${digitsOnly}`\n  return `+91${digitsOnly}` // default India\n}\n\nclass SupabaseAuthService {\n  // Send OTP via SMS\n  async sendOTP(phone) {\n    const formatted = normalizePhone(phone)\n    if (!formatted) {\n      return { success: false, error: 'Please enter a valid phone number' }\n    }\n\n    // Helpful debug log in development\n    if (process.env.NODE_ENV !== 'production') {\n      // eslint-disable-next-line no-console\n      console.debug('[Supabase] Sending OTP to', formatted)\n    }\n\n    const options = {\n      // 60s default. You can raise on server side in Supabase Auth settings.\n      shouldCreateUser: true\n    }\n    // Only force SMS channel if explicitly enabled via env and provider is configured\n    if (process.env.REACT_APP_SUPABASE_USE_SMS_CHANNEL === 'true') {\n      options.channel = 'sms'\n    }\n\n    const { data, error } = await supabase.auth.signInWithOtp({\n      phone: formatted,\n      options\n    })\n\n    if (error) {\n      if (process.env.NODE_ENV !== 'production') {\n        // eslint-disable-next-line no-console\n        console.error('[Supabase] signInWithOtp error', { status: error.status, message: error.message, phone: formatted })\n      }\n      // Provide actionable guidance for common 400 issues\n      let message = error.message || 'Failed to send OTP'\n      if (String(error.message).toLowerCase().includes('phone')) {\n        message = 'Invalid phone number. Use full number with country code, e.g. +919733960909'\n      }\n      // When using Test Phone Numbers in Supabase, ensure mapping includes country code without plus, e.g. 919733960909=123456\n      if (error.status === 400) {\n        message += ' • Check Supabase Auth: Providers → Phone is enabled and SMS provider or Test Phone Numbers are configured (use 919...=123456 for India)'\n      }\n      if (String(error.message).toLowerCase().includes('unsupported phone provider')) {\n        message = 'Unsupported phone provider. Either configure an SMS provider (Twilio) in Supabase Auth or remove forcing the SMS channel. You can enable SMS channel by setting REACT_APP_SUPABASE_USE_SMS_CHANNEL=true (requires dev server restart). For testing without Twilio, keep it false and use Test Phone Numbers.'\n      }\n      if (process.env.NODE_ENV !== 'production') {\n        message += ` • Sent phone: ${formatted}`\n      }\n      return { success: false, error: message }\n    }\n\n    return { success: true, data }\n  }\n\n  // Verify the OTP and sign in\n  async verifyOTP(phone, token, additionalData = {}) {\n    const formatted = normalizePhone(phone)\n    if (!formatted || !token) {\n      return { success: false, error: 'Phone and OTP are required' }\n    }\n\n    const { data, error } = await supabase.auth.verifyOtp({\n      phone: formatted,\n      token,\n      type: 'sms'\n    })\n\n    if (error) {\n      return { success: false, error: error.message }\n    }\n\n    const { user, session } = data || {}\n\n    // Optionally create/update a profile in Firestore to match your existing schema\n    if (db && user?.id) {\n      try {\n        await ensureFirebaseAuth()\n        // dynamic import to avoid hard dependency when Firebase isn't present\n        const { doc, getDoc, setDoc, updateDoc } = await import('firebase/firestore')\n        const userRef = doc(db, 'users', user.id)\n        const snap = await getDoc(userRef)\n        const payload = {\n          uid: user.id,\n          phoneNumber: user.phone,\n          lastLogin: new Date(),\n          updatedAt: new Date(),\n          // Tie this Supabase user doc to the current Firebase (anonymous) auth uid for Firestore rules\n          authUid: firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : undefined,\n          ...additionalData\n        }\n        if (!snap.exists()) {\n          await setDoc(userRef, { ...payload, createdAt: new Date(), addresses: [], orderHistory: [] })\n        } else {\n          await updateDoc(userRef, payload)\n        }\n      } catch (profileErr) {\n        // eslint-disable-next-line no-console\n        console.warn('[Supabase] Skipped Firestore profile sync:', profileErr?.message)\n      }\n    }\n\n    return { success: true, user, session }\n  }\n\n  // Get current Supabase session/user\n  async getSession() {\n    const { data } = await supabase.auth.getSession()\n    return data?.session || null\n  }\n\n  async getUser() {\n    const { data } = await supabase.auth.getUser()\n    return data?.user || null\n  }\n\n  async signOut() {\n    const { error } = await supabase.auth.signOut()\n    if (error) return { success: false, error: error.message }\n    return { success: true }\n  }\n\n  // Auth state listener compatible with Firebase\n  onAuthStateChanged(callback) {\n    // Get initial session\n    this.getUser().then(user => {\n      callback(user);\n    });\n\n    // Listen for auth changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\n      callback(session?.user || null);\n    });\n\n    // Return unsubscribe function\n    return () => {\n      subscription.unsubscribe();\n    };\n  }\n\n  // User profile management methods (compatible with Firebase structure)\n  async getUserProfile(userId) {\n    if (!db) {\n      // If no Firebase, return basic profile from Supabase user\n      const user = await this.getUser();\n      return user ? {\n        uid: user.id,\n        phoneNumber: user.phone,\n        displayName: user.user_metadata?.displayName || '',\n        addresses: [],\n        orderHistory: []\n      } : null;\n    }\n\n    try {\n      // Ensure we are signed into Firebase (anonymous) before reading\n      await ensureFirebaseAuth()\n      const { doc, getDoc } = await import('firebase/firestore');\n      const userRef = doc(db, 'users', userId);\n      const snap = await getDoc(userRef);\n      return snap.exists() ? snap.data() : null;\n    } catch (error) {\n      console.error('Error getting user profile:', error);\n      return null;\n    }\n  }\n\n  async updateUserProfile(userId, profileData) {\n    if (!db) {\n      return { success: false, error: 'Firestore not available' };\n    }\n\n    try {\n      await ensureFirebaseAuth()\n      const { doc, setDoc } = await import('firebase/firestore');\n      const userRef = doc(db, 'users', userId);\n      const payload = {\n        ...profileData,\n        updatedAt: new Date(),\n        // Ensure authUid present when creating via merge (satisfies create rule)\n        authUid: firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : undefined\n      };\n      await setDoc(userRef, payload, { merge: true });\n      return { success: true };\n    } catch (error) {\n      console.error('Error updating user profile:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  async addAddress(userId, address) {\n    if (!db) {\n      return { success: false, error: 'Firestore not available' };\n    }\n\n    try {\n      await ensureFirebaseAuth()\n      const { doc, getDoc, setDoc, updateDoc, arrayUnion } = await import('firebase/firestore');\n      const userRef = doc(db, 'users', userId);\n      const snap = await getDoc(userRef);\n      if (!snap.exists()) {\n        await setDoc(\n          userRef,\n          {\n            addresses: [address],\n            updatedAt: new Date(),\n            createdAt: new Date(),\n            authUid: firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : undefined\n          },\n          { merge: true }\n        );\n      } else {\n        await updateDoc(userRef, {\n          addresses: arrayUnion(address),\n          updatedAt: new Date()\n        });\n      }\n      return { success: true };\n    } catch (error) {\n      console.error('Error adding address:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  // Alias for signOut to match Firebase interface\n  async logout() {\n    return await this.signOut();\n  }\n\n  // Cleanup method (no-op for Supabase)\n  cleanup() {\n    // No cleanup needed for Supabase\n  }\n}\n\nconst supabaseAuth = new SupabaseAuthService()\nexport default supabaseAuth\n","// src/lib/supabaseClient.js\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  // Log a helpful warning once during app startup\n  // Avoid throwing to not break non-auth pages\n  // eslint-disable-next-line no-console\n  console.warn('[Supabase] Missing REACT_APP_SUPABASE_URL or REACT_APP_SUPABASE_ANON_KEY in .env')\n}\n\nexport const supabase = createClient(supabaseUrl || '', supabaseAnonKey || '')\n"],"names":["_anonAuthStarted","ensureFirebaseAuth","async","signInAnonymously","onAuthStateChanged","firebaseAuth","currentUser","Promise","resolve","unsub","e","console","warn","message","normalizePhone","phone","digitsOnly","String","replace","startsWith","concat","sendOTP","formatted","success","error","options","shouldCreateUser","process","REACT_APP_SUPABASE_USE_SMS_CHANNEL","channel","data","supabase","auth","signInWithOtp","toLowerCase","includes","status","verifyOTP","token","additionalData","arguments","length","undefined","verifyOtp","type","user","session","db","id","doc","getDoc","setDoc","updateDoc","userRef","snap","payload","_objectSpread","uid","phoneNumber","lastLogin","Date","updatedAt","authUid","exists","createdAt","addresses","orderHistory","profileErr","getSession","getUser","signOut","callback","this","then","subscription","onAuthStateChange","event","unsubscribe","getUserProfile","userId","_user$user_metadata","displayName","user_metadata","updateUserProfile","profileData","merge","addAddress","address","arrayUnion","logout","cleanup","supabaseUrl","supabaseAnonKey","createClient"],"sourceRoot":""}