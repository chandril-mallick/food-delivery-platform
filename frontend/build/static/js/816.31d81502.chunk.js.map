{"version":3,"file":"static/js/816.31d81502.chunk.js","mappings":"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","sources":["services/authService.js"],"sourcesContent":["import {\n  signInWithPhoneNumber,\n  RecaptchaVerifier,\n  signOut,\n  updateProfile,\n  onAuthStateChanged\n} from 'firebase/auth';\nimport { doc, setDoc, getDoc, updateDoc } from 'firebase/firestore';\nimport { auth, db } from '../firebase/config';\n\nclass AuthService {\n  constructor() {\n    this.recaptchaVerifier = null;\n  }\n\n  // Initialize reCAPTCHA verifier\n  initializeRecaptcha(containerId = 'recaptcha-container') {\n    // Always create a fresh verifier to avoid stale tokens\n    this.cleanupRecaptcha();\n    \n    // Check if container exists in DOM - don't create it if missing\n    try {\n      if (typeof window !== 'undefined' && typeof document !== 'undefined') {\n        const container = document.getElementById(containerId);\n        if (!container) {\n          console.warn(`reCAPTCHA container '${containerId}' not found in DOM. Make sure it exists in your component.`);\n          throw new Error(`reCAPTCHA container '${containerId}' not found`);\n        }\n      }\n    } catch (error) {\n      console.warn('DOM container check failed:', error);\n      throw error;\n    }\n\n    try {\n      // Firebase v9 modular API: RecaptchaVerifier(auth, containerId, parameters)\n      this.recaptchaVerifier = new RecaptchaVerifier(\n        auth, // First parameter: auth instance\n        containerId, // Second parameter: container ID\n        {\n          size: 'normal', // Keep visible for Identity Platform debugging\n          theme: 'light',\n          callback: (response) => {\n            console.log('reCAPTCHA solved, response length:', response?.length);\n          },\n          'expired-callback': () => {\n            console.log('reCAPTCHA expired, recreating...');\n            this.cleanupRecaptcha();\n          },\n          'error-callback': (error) => {\n            console.error('reCAPTCHA error:', error);\n          }\n        }\n      );\n\n      console.log('RecaptchaVerifier created successfully for Identity Platform');\n      return this.recaptchaVerifier;\n    } catch (error) {\n      console.error('Failed to create RecaptchaVerifier:', error);\n      throw error;\n    }\n  }\n\n  // Cleanup reCAPTCHA\n  cleanupRecaptcha() {\n    if (this.recaptchaVerifier && typeof this.recaptchaVerifier.clear === 'function') {\n      try {\n        this.recaptchaVerifier.clear();\n      } catch (_) {\n        // ignore\n      }\n    }\n    this.recaptchaVerifier = null;\n  }\n\n  // Send OTP to phone number\n  async sendOTP(phoneNumber) {\n    try {\n      // Ensure phone number is in E.164 format\n      const digitsOnly = (phoneNumber || '').replace(/\\D/g, '');\n      let formattedPhone = '';\n      if (digitsOnly.startsWith('91')) {\n        formattedPhone = `+${digitsOnly}`;\n      } else if (phoneNumber.startsWith('+')) {\n        formattedPhone = `+${digitsOnly}`;\n      } else {\n        formattedPhone = `+91${digitsOnly}`;\n      }\n\n      console.log('Identity Platform: Attempting to send OTP to:', formattedPhone);\n\n      // Create fresh reCAPTCHA verifier with explicit render\n      const recaptchaVerifier = this.initializeRecaptcha();\n      \n      // Wait for reCAPTCHA to fully render before proceeding\n      try {\n        await recaptchaVerifier.render();\n        console.log('reCAPTCHA rendered successfully');\n      } catch (renderError) {\n        console.warn('reCAPTCHA render warning:', renderError);\n      }\n\n      // Add a small delay to ensure reCAPTCHA is ready\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      console.log('Identity Platform: RecaptchaVerifier ready, attempting signInWithPhoneNumber...');\n      const confirmationResult = await signInWithPhoneNumber(auth, formattedPhone, recaptchaVerifier);\n\n      console.log('Identity Platform: OTP sent successfully');\n      return {\n        success: true,\n        confirmationResult,\n        message: 'OTP sent successfully'\n      };\n    } catch (error) {\n      console.error('Identity Platform Error sending OTP:', {\n        code: error?.code,\n        message: error?.message,\n        data: error?.customData,\n        stack: error?.stack\n      });\n      \n      // Provide more specific error messages for Identity Platform\n      let userMessage = 'Failed to send OTP';\n      if (error?.code === 'auth/invalid-app-credential') {\n        userMessage = 'Identity Platform: App credentials invalid. This may be due to reCAPTCHA configuration or project settings.';\n      } else if (error?.code === 'auth/captcha-check-failed') {\n        userMessage = 'reCAPTCHA verification failed. Please complete the reCAPTCHA and try again.';\n      } else if (error?.code === 'auth/invalid-phone-number') {\n        userMessage = 'Invalid phone number format. Please check and try again.';\n      } else if (error?.code === 'auth/quota-exceeded') {\n        userMessage = 'SMS quota exceeded. Please try again later.';\n      } else if (error?.code === 'auth/too-many-requests') {\n        userMessage = 'ðŸŽ‰ Phone auth is working! Rate limit reached - please wait 15-30 minutes or try a different phone number.';\n      }\n\n      return {\n        success: false,\n        error: userMessage,\n        errorCode: error?.code\n      };\n    }\n  }\n\n  // Verify OTP and complete login\n  async verifyOTP(confirmationResult, otp) {\n    try {\n      const result = await confirmationResult.confirm(otp);\n      const user = result.user;\n\n      // Create/update profile\n      await this.createOrUpdateUserProfile(user);\n\n      return {\n        success: true,\n        user,\n        message: 'Login successful'\n      };\n    } catch (error) {\n      console.error('Error verifying OTP:', error);\n      return {\n        success: false,\n        error: 'Invalid OTP. Please try again.'\n      };\n    }\n  }\n\n  // Create or update user profile in Firestore\n  async createOrUpdateUserProfile(user, additionalData = {}) {\n    try {\n      const userRef = doc(db, 'users', user.uid);\n      const userSnap = await getDoc(userRef);\n\n      const userData = {\n        uid: user.uid,\n        phoneNumber: user.phoneNumber,\n        lastLogin: new Date(),\n        updatedAt: new Date(),\n        ...additionalData\n      };\n\n      if (!userSnap.exists()) {\n        // Create profile\n        userData.createdAt = new Date();\n        userData.name = additionalData.name || '';\n        userData.email = additionalData.email || '';\n        userData.addresses = [];\n        userData.orderHistory = [];\n\n        await setDoc(userRef, userData);\n      } else {\n        // Update profile\n        await updateDoc(userRef, userData);\n      }\n\n      return userData;\n    } catch (error) {\n      console.error('Error creating/updating user profile:', error);\n      throw error;\n    }\n  }\n\n  // Get user profile\n  async getUserProfile(userId) {\n    try {\n      const userRef = doc(db, 'users', userId);\n      const userSnap = await getDoc(userRef);\n\n      return userSnap.exists() ? userSnap.data() : null;\n    } catch (error) {\n      console.error('Error getting user profile:', error);\n      throw error;\n    }\n  }\n\n  // Update profile\n  async updateUserProfile(userId, profileData) {\n    try {\n      const userRef = doc(db, 'users', userId);\n      const updateData = {\n        ...profileData,\n        updatedAt: new Date()\n      };\n\n      await updateDoc(userRef, updateData);\n\n      if (profileData.name && auth.currentUser) {\n        await updateProfile(auth.currentUser, {\n          displayName: profileData.name\n        });\n      }\n\n      return {\n        success: true,\n        message: 'Profile updated successfully'\n      };\n    } catch (error) {\n      console.error('Error updating user profile:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n\n  // Add address\n  async addAddress(userId, address) {\n    try {\n      const userRef = doc(db, 'users', userId);\n      const userSnap = await getDoc(userRef);\n\n      if (userSnap.exists()) {\n        const userData = userSnap.data();\n        const addresses = userData.addresses || [];\n\n        const newAddress = {\n          id: Date.now().toString(),\n          ...address,\n          createdAt: new Date()\n        };\n\n        addresses.push(newAddress);\n\n        await updateDoc(userRef, {\n          addresses,\n          updatedAt: new Date()\n        });\n\n        return {\n          success: true,\n          address: newAddress,\n          message: 'Address added successfully'\n        };\n      }\n    } catch (error) {\n      console.error('Error adding address:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n\n  // Logout\n  async logout() {\n    try {\n      await signOut(auth);\n      this.recaptchaVerifier = null;\n      return {\n        success: true,\n        message: 'Logged out successfully'\n      };\n    } catch (error) {\n      console.error('Error logging out:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n\n  // Auth state listener\n  onAuthStateChanged(callback) {\n    return onAuthStateChanged(auth, callback);\n  }\n\n  // Full cleanup\n  cleanup() {\n    if (this.recaptchaVerifier) {\n      if (typeof this.recaptchaVerifier.clear === 'function') {\n        this.recaptchaVerifier.clear();\n      }\n      this.recaptchaVerifier = null;\n    }\n  }\n}\n\nconst authService = new AuthService();\nexport default authService;\n"],"names":["constructor","this","recaptchaVerifier","initializeRecaptcha","containerId","arguments","length","undefined","cleanupRecaptcha","window","document","getElementById","console","warn","concat","Error","error","RecaptchaVerifier","auth","size","theme","callback","response","log","expired-callback","clear","_","sendOTP","phoneNumber","digitsOnly","replace","formattedPhone","startsWith","render","renderError","Promise","resolve","setTimeout","confirmationResult","signInWithPhoneNumber","success","message","code","data","customData","stack","userMessage","errorCode","verifyOTP","otp","user","confirm","createOrUpdateUserProfile","additionalData","userRef","doc","db","uid","userSnap","getDoc","userData","_objectSpread","lastLogin","Date","updatedAt","exists","updateDoc","createdAt","name","email","addresses","orderHistory","setDoc","getUserProfile","userId","updateUserProfile","profileData","updateData","currentUser","updateProfile","displayName","addAddress","address","newAddress","id","now","toString","push","logout","signOut","onAuthStateChanged","cleanup"],"sourceRoot":""}